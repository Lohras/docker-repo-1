pipeline { 
  agent { label 'master' } 
  environment {
    SPECTRAL_DSN = credentials('spectral-dsn')
  }
  stages {
    stage('install Spectral') {
      // preflight is a tool that makes sure your CI processes run securely and are safe to use. 
      // To learn more and install preflight, see here: https://github.com/SpectralOps/preflight
      steps {
        sh "curl -L 'https://get.spectralops.io/latest/x/sh?dsn=$SPECTRAL_DSN' | preflight run" 
      }
    }
    stage('scan for issues') {
      steps {
        sh "$HOME/.spectral/spectral scan --ok" 
      }
    }
    stage('build') {
      steps {
        // your build scripts
        sh "./build.sh" 
      }
    }
  }
}
